{% extends 'base.html.twig' %}

{% block title %}Заказать услугу оценки{% endblock %}

{% block body %}
    <h1>Заказать услугу оценки</h1>

    {% for message in app.flashes('success') %}
        <div style="color: #166534; margin-bottom: 12px;">{{ message }}</div>
    {% endfor %}

    <div style="margin-bottom: 12px;">
        Вы авторизованы как {{ app.user.userIdentifier }}.
        <a href="{{ path('app_logout') }}">Выйти</a>
    </div>

    <div id="order-form-data" data-services="{{ services|json_encode|e('html_attr') }}">
    {{ form_start(orderForm) }}
        {{ form_row(orderForm.service) }}
        {{ form_row(orderForm.email) }}

        <div style="margin: 12px 0;">
            <strong>Стоимость:</strong>
            <span id="service-price">0 р.</span>
        </div>

        <button type="submit">Подтвердить</button>
    {{ form_end(orderForm) }}
    </div>

    <script>
        (() => {
            const dataNode = document.getElementById('order-form-data');
            const prices = JSON.parse(dataNode?.dataset.services ?? '{}');
            const select = document.getElementById('order_service');
            const priceNode = document.getElementById('service-price');

            const updatePrice = () => {
                if (!select || !priceNode) {
                    return;
                }

                const price = prices[select.value] ?? 0;
                priceNode.textContent = `${price} р.`;
            };

            if (select) {
                select.addEventListener('change', updatePrice);
                updatePrice();
            }
        })();
    </script>
{% endblock %}
